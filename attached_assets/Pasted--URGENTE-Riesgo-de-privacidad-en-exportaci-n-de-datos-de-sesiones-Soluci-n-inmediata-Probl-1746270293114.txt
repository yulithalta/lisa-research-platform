# URGENTE: Riesgo de privacidad en exportación de datos de sesiones - Solución inmediata

## Problema de seguridad y privacidad detectado

Hemos identificado un problema grave de seguridad en el componente de exportación de datos de sesiones. El sistema actual utiliza un método de "mejor esfuerzo" para localizar los archivos MP4 y otros datos pertenecientes a cada sesión, basándose en búsquedas por patrones en nombres de archivos.

**Riesgo crítico**: Existe un alto riesgo de que se mezclen datos entre diferentes usuarios o sesiones, lo que compromete seriamente la confidencialidad y privacidad de los datos médicos y de investigación.

## Solución propuesta - Implementación inmediata

Necesitamos implementar un sistema de identificación único para todas las sesiones nuevas que garantice que cada archivo generado se pueda asociar inequívocamente con su sesión correspondiente.

### Cambios necesarios:

1. **Crear identificador único (hash) para cada sesión**:
   - Generar un UUID corto (primeros 8 caracteres) al crear una nueva sesión
   - Almacenar este hash en los metadatos de la sesión y en config.json

2. **Implementar un archivo de índice por sesión**:
   - Crear `session_files_index.json` para cada sesión
   - Registrar todos los archivos generados (MP4, JSON, CSV) con sus rutas

3. **Modificar nomenclatura de archivos generados**:
   - Formato: `{prefijo}_{hash_sesion}_{timestamp}.extensión`
   - Ejemplo: `cam1_8f4d7a9c_20250101120000.mp4`

4. **Actualizar el servicio de archivado (ZIP)**:
   - Priorizar el uso del archivo de índice para encontrar archivos
   - Mantener compatibilidad con sesiones antiguas

### Impacto en archivos del código:

- `routes.ts` - Modificar función POST `/api/sessions` y `startRecording()`
- `mqtt-client-simple.ts` - Actualizar `registerSession()` para usar el hash
- `archive-service.ts` - Modificar `addAdditionalSessionFiles()` para usar el índice

## Urgencia y prioridad

Dado que estamos trabajando con datos médicos en un entorno de living lab, este problema representa un riesgo crítico de incumplimiento de protección de datos personales sensibles. Solicitamos implementación inmediata para las nuevas sesiones.

---

La solución propuesta mantendrá la compatibilidad con sesiones antiguas mientras asegura que todas las sesiones nuevas utilicen el sistema seguro de identificación unívoca.