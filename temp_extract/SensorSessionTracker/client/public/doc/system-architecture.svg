<?xml version="1.0" encoding="UTF-8"?>
<svg width="900" height="650" xmlns="http://www.w3.org/2000/svg">
  <!-- Definición de estilos y marcadores -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
    </marker>
    <linearGradient id="client-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#4F46E5;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#7C3AED;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="server-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#10B981;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="data-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#EC4899;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#DB2777;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="camera-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#F59E0B;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#D97706;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="sensor-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#0EA5E9;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#0284C7;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="3" dy="3" stdDeviation="5" flood-opacity="0.2"/>
    </filter>
  </defs>

  <!-- Título del diagrama -->
  <text x="450" y="35" font-family="Arial" font-size="24" font-weight="bold" text-anchor="middle" fill="#333">LISA - Living-lab Integrated Sensing Architecture</text>
  <text x="450" y="60" font-family="Arial" font-size="14" text-anchor="middle" fill="#666">Diagrama de Arquitectura del Sistema</text>

  <!-- Clúster de Cliente (Frontend) -->
  <rect x="50" y="100" width="300" height="200" rx="10" ry="10" fill="url(#client-gradient)" filter="url(#shadow)" opacity="0.9"/>
  <text x="200" y="125" font-family="Arial" font-size="18" font-weight="bold" text-anchor="middle" fill="white">Frontend (Client)</text>
  
  <!-- Componentes del Frontend -->
  <rect x="75" y="145" width="250" height="40" rx="5" ry="5" fill="white" opacity="0.9" stroke="#4F46E5" stroke-width="1"/>
  <text x="200" y="170" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle" fill="#333">React Components</text>
  
  <rect x="75" y="195" width="250" height="40" rx="5" ry="5" fill="white" opacity="0.9" stroke="#4F46E5" stroke-width="1"/>
  <text x="200" y="220" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle" fill="#333">TanStack Query / State Management</text>
  
  <rect x="75" y="245" width="115" height="40" rx="5" ry="5" fill="white" opacity="0.9" stroke="#4F46E5" stroke-width="1"/>
  <text x="132" y="270" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle" fill="#333">Wouter Router</text>
  
  <rect x="205" y="245" width="120" height="40" rx="5" ry="5" fill="white" opacity="0.9" stroke="#4F46E5" stroke-width="1"/>
  <text x="265" y="270" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle" fill="#333">Tailwind CSS</text>

  <!-- Clúster de Servidor (Backend) -->
  <rect x="450" y="100" width="350" height="250" rx="10" ry="10" fill="url(#server-gradient)" filter="url(#shadow)" opacity="0.9"/>
  <text x="625" y="125" font-family="Arial" font-size="18" font-weight="bold" text-anchor="middle" fill="white">Backend (Server)</text>
  
  <!-- Componentes del Backend -->
  <rect x="475" y="145" width="300" height="40" rx="5" ry="5" fill="white" opacity="0.9" stroke="#10B981" stroke-width="1"/>
  <text x="625" y="170" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle" fill="#333">Express API Endpoints</text>
  
  <rect x="475" y="195" width="140" height="40" rx="5" ry="5" fill="white" opacity="0.9" stroke="#10B981" stroke-width="1"/>
  <text x="545" y="220" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle" fill="#333">Session Manager</text>
  
  <rect x="635" y="195" width="140" height="40" rx="5" ry="5" fill="white" opacity="0.9" stroke="#10B981" stroke-width="1"/>
  <text x="705" y="220" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle" fill="#333">Authentication</text>
  
  <rect x="475" y="245" width="140" height="40" rx="5" ry="5" fill="white" opacity="0.9" stroke="#10B981" stroke-width="1"/>
  <text x="545" y="270" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle" fill="#333">Camera Controller</text>
  
  <rect x="635" y="245" width="140" height="40" rx="5" ry="5" fill="white" opacity="0.9" stroke="#10B981" stroke-width="1"/>
  <text x="705" y="270" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle" fill="#333">Sensor Controller</text>
  
  <rect x="475" y="295" width="300" height="40" rx="5" ry="5" fill="white" opacity="0.9" stroke="#10B981" stroke-width="1"/>
  <text x="625" y="320" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle" fill="#333">WebSocket Server (Real-time Updates)</text>

  <!-- Clúster de Almacenamiento de Datos -->
  <rect x="200" y="375" width="500" height="70" rx="10" ry="10" fill="url(#data-gradient)" filter="url(#shadow)" opacity="0.9"/>
  <text x="450" y="400" font-family="Arial" font-size="18" font-weight="bold" text-anchor="middle" fill="white">Storage Layer</text>
  
  <!-- Componentes de Almacenamiento -->
  <rect x="225" y="420" width="100" height="40" rx="5" ry="5" fill="white" opacity="0.9" stroke="#EC4899" stroke-width="1"/>
  <text x="275" y="443" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle" fill="#333">Memory Storage</text>
  
  <rect x="345" y="420" width="100" height="40" rx="5" ry="5" fill="white" opacity="0.9" stroke="#EC4899" stroke-width="1"/>
  <text x="395" y="443" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle" fill="#333">File System</text>
  
  <rect x="465" y="420" width="100" height="40" rx="5" ry="5" fill="white" opacity="0.9" stroke="#EC4899" stroke-width="1"/>
  <text x="515" y="443" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle" fill="#333">Session Data</text>
  
  <rect x="585" y="420" width="90" height="40" rx="5" ry="5" fill="white" opacity="0.9" stroke="#EC4899" stroke-width="1"/>
  <text x="630" y="443" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle" fill="#333">User Data</text>

  <!-- Clúster de Dispositivos Externos -->
  <rect x="50" y="480" width="300" height="150" rx="10" ry="10" fill="url(#camera-gradient)" filter="url(#shadow)" opacity="0.9"/>
  <text x="200" y="505" font-family="Arial" font-size="18" font-weight="bold" text-anchor="middle" fill="white">IP Cameras</text>
  
  <!-- Componentes de Cámaras IP -->
  <rect x="75" y="525" width="115" height="40" rx="5" ry="5" fill="white" opacity="0.9" stroke="#F59E0B" stroke-width="1"/>
  <text x="132" y="550" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle" fill="#333">RTSP Streams</text>
  
  <rect x="205" y="525" width="120" height="40" rx="5" ry="5" fill="white" opacity="0.9" stroke="#F59E0B" stroke-width="1"/>
  <text x="265" y="550" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle" fill="#333">HTTP Verification</text>
  
  <rect x="75" y="575" width="250" height="40" rx="5" ry="5" fill="white" opacity="0.9" stroke="#F59E0B" stroke-width="1"/>
  <text x="200" y="600" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle" fill="#333">FFMPEG Recording Pipeline</text>

  <!-- Clúster de Sensores MQTT/Zigbee -->
  <rect x="550" y="480" width="300" height="150" rx="10" ry="10" fill="url(#sensor-gradient)" filter="url(#shadow)" opacity="0.9"/>
  <text x="700" y="505" font-family="Arial" font-size="18" font-weight="bold" text-anchor="middle" fill="white">MQTT/Zigbee Sensors</text>
  
  <!-- Componentes de Sensores -->
  <rect x="575" y="525" width="115" height="40" rx="5" ry="5" fill="white" opacity="0.9" stroke="#0EA5E9" stroke-width="1"/>
  <text x="632" y="550" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle" fill="#333">MQTT Broker</text>
  
  <rect x="705" y="525" width="120" height="40" rx="5" ry="5" fill="white" opacity="0.9" stroke="#0EA5E9" stroke-width="1"/>
  <text x="765" y="550" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle" fill="#333">Zigbee2MQTT</text>
  
  <rect x="575" y="575" width="250" height="40" rx="5" ry="5" fill="white" opacity="0.9" stroke="#0EA5E9" stroke-width="1"/>
  <text x="700" y="600" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle" fill="#333">Observer Pattern Data Collection</text>

  <!-- Conexiones entre componentes (flechas) -->
  <!-- Frontend to Backend -->
  <line x1="350" y1="200" x2="450" y2="200" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="400" y="190" font-family="Arial" font-size="12" text-anchor="middle" fill="#333">HTTP/WS</text>
  
  <!-- Backend to Storage -->
  <line x1="625" y1="350" x2="625" y2="375" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="660" y="365" font-family="Arial" font-size="12" text-anchor="middle" fill="#333">CRUD</text>
  
  <!-- Backend to Cameras -->
  <path d="M475 265 Q400 320 300 480" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <text x="375" y="350" font-family="Arial" font-size="12" text-anchor="middle" fill="#333">RTSP/HTTP</text>
  
  <!-- Backend to MQTT -->
  <path d="M775 265 Q750 320 700 480" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <text x="750" y="350" font-family="Arial" font-size="12" text-anchor="middle" fill="#333">MQTT/WS</text>
  
  <!-- Leyenda -->
  <rect x="750" y="30" width="20" height="15" fill="url(#client-gradient)"/>
  <text x="775" y="43" font-family="Arial" font-size="12" fill="#333">Frontend</text>
  
  <rect x="750" y="50" width="20" height="15" fill="url(#server-gradient)"/>
  <text x="775" y="63" font-family="Arial" font-size="12" fill="#333">Backend</text>
  
  <rect x="750" y="70" width="20" height="15" fill="url(#data-gradient)"/>
  <text x="775" y="83" font-family="Arial" font-size="12" fill="#333">Storage</text>
  
  <rect x="830" y="30" width="20" height="15" fill="url(#camera-gradient)"/>
  <text x="855" y="43" font-family="Arial" font-size="12" fill="#333">Cameras</text>
  
  <rect x="830" y="50" width="20" height="15" fill="url(#sensor-gradient)"/>
  <text x="855" y="63" font-family="Arial" font-size="12" fill="#333">Sensors</text>
  
  <!-- Nota sobre el Patrón Observer -->
  <rect x="380" y="480" width="160" height="80" rx="5" ry="5" fill="white" stroke="#333" stroke-width="1" stroke-dasharray="5,5"/>
  <text x="460" y="505" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle" fill="#333">Observer Pattern</text>
  <text x="460" y="525" font-family="Arial" font-size="12" text-anchor="middle" fill="#666">Implementado para</text>
  <text x="460" y="540" font-family="Arial" font-size="12" text-anchor="middle" fill="#666">gestión escalable</text>
  <text x="460" y="555" font-family="Arial" font-size="12" text-anchor="middle" fill="#666">de sensores</text>

  <!-- Fecha de actualización -->
  <text x="50" y="645" font-family="Arial" font-size="10" fill="#666">Última actualización: Abril 2025</text>
  
  <!-- Versión del Sistema -->
  <text x="830" y="645" font-family="Arial" font-size="10" text-anchor="end" fill="#666">LISA v2.5.20</text>
</svg>