# Configuración global de Telegraf
[agent]
  # Intervalo de recogida de datos por defecto
  interval = "10s"
  
  # Configuración del buffer (1000 puntos antes de escribir en InfluxDB)
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  
  # Redondeo del intervalo para alinear con el tiempo del sistema
  round_interval = true
  
  # Flush de métricas basado en intervalos
  flush_interval = "60s"
  
  # Nombre del host
  hostname = "lisa_monitoring"
  
  # Omitir verificación de hostname (útil en entornos de desarrollo)
  omit_hostname = false

# Configuración de InfluxDB v2
[[outputs.influxdb_v2]]
  # URL para InfluxDB v2
  urls = ["http://influxdb:8086"]
  
  # Token de acceso (obligatorio para API de InfluxDB v2)
  token = "${INFLUXDB_TOKEN}"
  
  # Organización destino
  organization = "${INFLUXDB_ORG}"
  
  # Bucket para almacenar los datos
  bucket = "${INFLUXDB_BUCKET}"
  
  # Timeout para escrituras a InfluxDB
  timeout = "5s"
  
  # Número de reintentos en caso de fallo de escritura
  max_retry_attempts = 3
  
  # Intervalo entre reintentos
  retry_delay = "30s"

# Configuración de MQTT (captura todos los temas)
[[inputs.mqtt_consumer]]
  # Lista de servidores MQTT (configurable mediante variables de entorno)
  servers = ["tcp://${MQTT_HOST:192.168.0.20}:${MQTT_PORT:1883}"]
  
  # Lista de temas MQTT a los que suscribirse
  # Utiliza # para capturar todos los temas
  topics = [
    "#",                # Captura todos los temas
    "zigbee2mqtt/#",    # Captura todos los temas de zigbee2mqtt
    "lisa/#"            # Captura todos los temas de lisa
  ]
  
  # Nombre de la medición
  name_override = "mqtt_consumer"
  
  # Formato de los datos (asumimos que todos son JSON)
  data_format = "json"
  
  # QoS para las suscripciones
  qos = 1
  
  # Retención de mensajes por si se desconecta
  persistent_session = true
  client_id = "telegraf_lisa"
  
  # Incluir etiquetas adicionales
  [inputs.mqtt_consumer.tags]
    source = "mqtt"
    application = "lisa"

# Incluir configuraciones adicionales de la carpeta telegraf.d
# Estas configuraciones pueden contener suscripciones MQTT específicas 
# para determinados tipos de sensores
[[inputs.file]]
  files = ["./telegraf.d/*.conf"]

# Recopilación de métricas del sistema host
[[inputs.cpu]]
  # Medir CPU por core
  percpu = true
  
  # Medir tiempo total de CPU
  totalcpu = true
  
  # Incluir estadísticas de tiempo raw
  collect_cpu_time = false
  
  # Reportar metricas activas
  report_active = false

[[inputs.mem]]
  # Sin configuración especial

[[inputs.disk]]
  # Puntos de montaje a ignorar
  ignore_fs = ["tmpfs", "devtmpfs", "devfs", "iso9660", "overlay", "aufs", "squashfs"]

[[inputs.diskio]]
  # Sin configuración especial

[[inputs.system]]
  # Sin configuración especial