version: "4.0"

services:
  # -------------------------
  # Zigbee2MQTT
  # -------------------------
  zigbee2mqtt:
    image: ghcr.io/koenkk/zigbee2mqtt:latest
    container_name: zigbee2mqtt
    restart: unless-stopped
    environment:
      - TZ=${TZ:-Europe/Madrid}
    ports:
      - "8080:8080"            # Zigbee2MQTT frontend
    volumes:
      - ${Z2M_DATA:-./z2m-data}:/app/data
      - /run/udev:/run/udev:ro
    devices:
      - ${Z2M_ADAPTER:-/dev/serial/by-id/usb-Texas_Instruments_TI_CC2531_USB_CDC___0X00124B0018ED3DDF-if00}:/dev/ttyACM0

  # -------------------------
  # Dozzle (Docker logs UI)
  # -------------------------
  dozzle:
    image: amir20/dozzle:latest
    container_name: dozzle
    restart: unless-stopped
    ports:
      - "9090:8080"            # Dozzle UI
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - DOZZLE_BASE=/          # optional
      # Recomendado: proteger con auth simple
      #- DOZZLE_AUTH_PROVIDER=simple
      #- DOZZLE_SIMPLE_USERNAME=${DOZZLE_USER:-admin}
      #- DOZZLE_SIMPLE_PASSWORD=${DOZZLE_PASS:-change-me}

  # -------------------------
  # Dashdot (Host metrics UI)
  # -------------------------
  dashdot:
    image: mauricenino/dashdot:latest
    container_name: dashdot
    restart: unless-stopped
    privileged: true
    ports:
      - "4000:3001"            # Host 3001 â†’ UI
    volumes:
      - /:/mnt/host:ro

  # -------------------------
  # Camera Backend
  # -------------------------
  camera-backend:
    image: chunche95/camera-backend:1.0
    container_name: camera-backend
    ports:
      - "3033:3033"
    volumes:
      - ./backend/streams:/app/streams
      - ./backend/logs:/app/logs
    restart: unless-stopped

  # -------------------------
  # Camera Frontend
  # -------------------------
  camera-frontend:
    image: chunche95/camera-frontend:1.0
    container_name: camera-frontend
    ports:
      - "3000:3000"
    depends_on:
      - camera-backend
    restart: unless-stopped

  # -------------------------
  # Crudsensor App
  # -------------------------
  crudsensor-app:
    image: chunche95/crudsensor-app:1.0
    container_name: crudsensor-app
    ports:
      - "3001:3001"
    restart: unless-stopped

  # -------------------------
  # Zigbee Dashboard
  # -------------------------
  zigbee-dashboard:
    image: chunche95/zigbee-dashboard:v2.5.2
    container_name: zigbee-dashboard
    ports:
      - "3002:3002"
    restart: unless-stopped

  # -------------------------
  # RGPD Module
  # -------------------------
  rgpd-module:
    image: chunche95/rgpd-module-rgpd-module:1.0.0
    container_name: rgpd-module
    ports:
      - "3003:3003"
    restart: unless-stopped
